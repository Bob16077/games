<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Location on Earth</title>
    <!-- Include Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <!-- Include Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <style>
        #popupWrapper{
            display:none;
            position:fixed;
            top:50%;
            left:50%;
            transform:translate(-50%,-50%);
            background:rgba(52,152,219,.8);
            padding:15px;
            color:#fff;
            text-align:center;
            z-index:1000;
            border-radius:8px;
            animation:fadeInOut 5s forwards
        }
        @keyframes fadeInOut{
            0%{
                opacity:0
            }
            10%{
                opacity:1
            }
            90%{
                opacity:1
            }
            100%{
                opacity:0
            }
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: Arial, sans-serif;
            margin: 0;
            overflow: hidden;
        }
    
        #map {
            flex-grow: 1;
            height: 100vh;
            width: 100vw;
        }

        #guessMap {
            position: fixed;
            bottom: 10px;
            right: 10px;
            height: calc(20vh + 35px);
            width: 20vw;
            z-index: 900;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease-in-out;
        }

        #guessMap:hover {
            height: calc(50vh + 35px);
            width: 50vw;
        }
    
        #guess-map {
            position: fixed;
            bottom: 35px;
            height: inherit;
            z-index: 910;
            width: inherit;
        }

        #guess-button{
            z-index:950;
            position:fixed;
            bottom:10px;
            height: 25px;
            margin: 0;
            width: inherit;
            font-size:18px;
            background-color:#0099ff;
            color:#fff;
            text-align:center;
            cursor:pointer;
        }

        #guess {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
        }
    
        .game-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            background-color: #3498db;
            color: #fff;
            padding: 15px;
            width: 100vw;
        }
    </style>
</head>
<body>

<header>
    <h1>Random Location Game</h1>
</header>

<main>
    <div id="map"></div>
    <div id = "guessMap">
        <div id="guess-map"></div>
        <button id="guess-button">Submit Guess</button>
    </div>
</main>

<footer>
    <div class="game-controls">
        <button id="new-game">New Game</button>
        <p id="feedback"></p>
        <p id="score">Score: 0</p>
    </div>
</footer>

<script src="data.js"></script>
<script>
    let score = 0;
    let currentLocation = [];

    function getRandomPoint() {
        currentLocation = data[Math.floor(Math.random() * data.length)];
        return currentLocation;
    }

    function initMap() {
        const randomPoint = getRandomPoint();

        var map = L.map('map', {attributionControl: false}).setView(randomPoint, 9);
        map.dragging.disable();

        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            tileSize: 512,
            zoomOffset: -1,
            minZoom: 9,
            maxZoom: 12
        }).addTo(map);

        var guessMap = L.map('guess-map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
            maxZoom: 18
        }).addTo(guessMap);

        var marker;
        guessMap.on('click', function(e) {
            if (marker) guessMap.removeLayer(marker);
            marker = L.marker(e.latlng, { icon: L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
        })}).addTo(guessMap)});

        guessMap.on('click', function(e) {
            const latDiff = Math.abs(e.latlng.lat - currentLocation[0]);
            const lngDiff = Math.abs(e.latlng.lng - currentLocation[1]);
            if (latDiff < 1 && lngDiff < 1) {
                document.getElementById('feedback').textContent = 'Correct!';
                score++;
            } else {
                document.getElementById('feedback').textContent = 'Incorrect. The correct location was ' + currentLocation;
            }
            document.getElementById('score').textContent = 'Score: ' + score;
        });
    }

    document.getElementById('new-game').addEventListener('click', function() {
        document.getElementById('feedback').textContent = '';
        initMap();
    });

    initMap();
    
    document.getElementById('guess-button').addEventListener('click', function() {
        if (marker) {
            //var coordinates = marker.getLatLng();
            //displayPopup('Copied: ' + coordinates.lat.toFixed(3) + ', ' + coordinates.lng.toFixed(3));
        } else {
            displayPopup('Please mark a position on the map first.');
        }
    });

    function displayPopup(message) {
        var popupWrapper = document.getElementById('popupWrapper');
        var popup = document.getElementById('popup');
        
        popup.innerHTML = message;
        
        popupWrapper.style.display = 'block';
        setTimeout(function() {
            popupWrapper.style.display = 'none';
        }, 4000);
    }
</script>

</body>
</html>